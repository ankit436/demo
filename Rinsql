-- Create tables without foreign keys
CREATE TABLE RIN_ROI_TYPE (
    TYPE_ID INT PRIMARY KEY,
    TYPE_NAME NVARCHAR2(200) NOT NULL,
    CREATED_DATE DATE DEFAULT SYSDATE,
    CREATED_BY NVARCHAR2(200),
    IS_DELETED NUMBER(1) DEFAULT 0 NOT NULL,
    DELETED_AT TIMESTAMP,
    CONSTRAINT CHK_TYPE_IS_DELETED CHECK (IS_DELETED IN (0, 1))
);

CREATE TABLE RIN_ROI_STATUS (
    STATUS_ID INT PRIMARY KEY,
    PROJECT_STATUS NVARCHAR2(200) NOT NULL,
    CREATED_DATE DATE DEFAULT SYSDATE,
    CREATED_BY NVARCHAR2(200),
    IS_DELETED NUMBER(1) DEFAULT 0 NOT NULL,
    DELETED_AT TIMESTAMP,
    CONSTRAINT CHK_STATUS_IS_DELETED CHECK (IS_DELETED IN (0, 1))
);

CREATE TABLE RIN_ROI_PROGRAM (
    PROGRAM_ID INT PRIMARY KEY,
    PROGRAM_NAME NVARCHAR2(200) NOT NULL,
    CREATED_DATE DATE DEFAULT SYSDATE,
    CREATED_BY NVARCHAR2(200),
    IS_DELETED NUMBER(1) DEFAULT 0 NOT NULL,
    DELETED_AT TIMESTAMP,
    CONSTRAINT CHK_PROGRAM_IS_DELETED CHECK (IS_DELETED IN (0, 1))
);

CREATE TABLE RIN_ROI_PHASE (
    PROJECT_PHASE_ID INT PRIMARY KEY,
    PROJECT_PHASE_NAME NVARCHAR2(200) NOT NULL,
    CREATED_DATE DATE DEFAULT SYSDATE,
    CREATED_BY NVARCHAR2(200),
    IS_DELETED NUMBER(1) DEFAULT 0 NOT NULL,
    DELETED_AT TIMESTAMP,
    CONSTRAINT CHK_PHASE_IS_DELETED CHECK (IS_DELETED IN (0, 1))
);

CREATE TABLE RIN_ROI_BUSINESS_UNIT (
    BU_ID INT PRIMARY KEY,
    BUSINESS_UNIT_NAME NVARCHAR2(200) NOT NULL,
    CREATED_DATE DATE DEFAULT SYSDATE,
    CREATED_BY NVARCHAR2(200),
    IS_DELETED NUMBER(1) DEFAULT 0 NOT NULL,
    DELETED_AT TIMESTAMP,
    CONSTRAINT CHK_BU_IS_DELETED CHECK (IS_DELETED IN (0, 1))
);

CREATE TABLE RIN_ROI_REGION (
    BU_ID INT PRIMARY KEY,
    BUSINESS_UNIT_NAME NVARCHAR2(200) NOT NULL,
    CREATED_DATE DATE DEFAULT SYSDATE,
    IS_DELETED NUMBER(1) DEFAULT 0 NOT NULL,
    DELETED_AT TIMESTAMP,
    CONSTRAINT CHK_REGION_IS_DELETED CHECK (IS_DELETED IN (0, 1))
);

-- Create tables with foreign key constraints
CREATE TABLE RIN_ROI_PROJECT (
    ID INT PRIMARY KEY,
    NAME NVARCHAR2(100) NOT NULL,
    START_DATE DATE,
    END_DATE DATE,
    TYPE INT NOT NULL,
    SPONSOR NVARCHAR2(200),
    IT_OWNER NVARCHAR2(200),
    STATUS INT NOT NULL,
    BUSINESS_OWNER NVARCHAR2(200),
    BUSINESS_OWNER1 NVARCHAR2(200),
    PROGRAM INT NOT NULL,
    BUSINESS_EVP NVARCHAR2(200),
    FUND NVARCHAR2(50),
    PHASE INT NOT NULL,
    IN_YEAR CLOB,
    IS_DELETED NUMBER(1) DEFAULT 0 NOT NULL,
    BU INT NOT NULL,
    BENEFICIARY_CLIENT_COUNT NVARCHAR2(100),
    BENEFICIARY_CLIENT_NAME NVARCHAR2(200),
    REGION INT NOT NULL,
    BENEFIT_TYPE NVARCHAR2(200),
    PROJECT_BENEFITS INT,
    IDEA_ID INT,
    GMAS_ID INT,
    DELETED_AT TIMESTAMP,
    CREATED_DATE DATE DEFAULT SYSDATE,
    DURATION AS (END_DATE - START_DATE) VIRTUAL,
    CONSTRAINT FK_PROJECT_TYPE FOREIGN KEY (TYPE) REFERENCES RIN_ROI_TYPE(TYPE_ID),
    CONSTRAINT FK_PROJECT_STATUS FOREIGN KEY (STATUS) REFERENCES RIN_ROI_STATUS(STATUS_ID),
    CONSTRAINT FK_PROJECT_PROGRAM FOREIGN KEY (PROGRAM) REFERENCES RIN_ROI_PROGRAM(PROGRAM_ID),
    CONSTRAINT FK_PROJECT_PHASE FOREIGN KEY (PHASE) REFERENCES RIN_ROI_PHASE(PROJECT_PHASE_ID),
    CONSTRAINT FK_PROJECT_BU FOREIGN KEY (BU) REFERENCES RIN_ROI_BUSINESS_UNIT(BU_ID),
    CONSTRAINT FK_PROJECT_REGION FOREIGN KEY (REGION) REFERENCES RIN_ROI_REGION(BU_ID),
    CONSTRAINT CHK_PROJECT_DATE_RANGE CHECK (START_DATE <= END_DATE),
    CONSTRAINT CHK_PROJECT_IS_DELETED CHECK (IS_DELETED IN (0, 1))
)
PARTITION BY RANGE (CREATED_DATE) (
    PARTITION P_2023 VALUES LESS THAN (TO_DATE('01-01-2024', 'DD-MM-YYYY')),
    PARTITION P_2024 VALUES LESS THAN (TO_DATE('01-01-2025', 'DD-MM-YYYY')),
    PARTITION P_FUTURE VALUES LESS THAN (MAXVALUE)
);

CREATE TABLE RIN_ROI_METRIC (
    METRIC_ID INT PRIMARY KEY,
    METRIC_NAME NVARCHAR2(200) NOT NULL,
    PROJECT_ID INT NOT NULL,
    TYPE NVARCHAR2(50) NOT NULL,
    CREATED_DATE DATE DEFAULT SYSDATE,
    UPDATED_DATE DATE,
    IS_DELETED NUMBER(1) DEFAULT 0 NOT NULL,
    DELETED_AT TIMESTAMP,
    CONSTRAINT FK_METRIC_PROJECT FOREIGN KEY (PROJECT_ID) REFERENCES RIN_ROI_PROJECT(ID),
    CONSTRAINT CHK_METRIC_IS_DELETED CHECK (IS_DELETED IN (0, 1))
)
PARTITION BY RANGE (CREATED_DATE) (
    PARTITION P_2023 VALUES LESS THAN (TO_DATE('01-01-2024', 'DD-MM-YYYY')),
    PARTITION P_2024 VALUES LESS THAN (TO_DATE('01-01-2025', 'DD-MM-YYYY')),
    PARTITION P_FUTURE VALUES LESS THAN (MAXVALUE)
);

CREATE TABLE RIN_ROI_PROJECT_USER (
    ID NVARCHAR2(50) PRIMARY KEY,
    PROJECT_ID INT NOT NULL,
    USER_ID NVARCHAR2(50),
    CREATED_DATE DATE DEFAULT SYSDATE,
    IS_DELETED NUMBER(1) DEFAULT 0 NOT NULL,
    DELETED_AT TIMESTAMP,
    CONSTRAINT FK_PROJECT_USER_PROJECT FOREIGN KEY (PROJECT_ID) REFERENCES RIN_ROI_PROJECT(ID),
    CONSTRAINT CHK_PROJECT_USER_IS_DELETED CHECK (IS_DELETED IN (0, 1))
);

CREATE TABLE RIN_ROI_PROJECT_BENEFITS (
    REPORT_ID INT PRIMARY KEY,
    PROJECT_ID INT NOT NULL,
    NAME NVARCHAR2(200),
    CONTENT CLOB,
    AS_OF_DATE DATE,
    CREATED_DATE DATE DEFAULT SYSDATE NOT NULL,
    CREATED_BY NVARCHAR2(200),
    IS_DELETED NUMBER(1) DEFAULT 0 NOT NULL,
    DELETED_AT TIMESTAMP,
    CONSTRAINT FK_PROJECT_BENEFITS_PROJECT FOREIGN KEY (PROJECT_ID) REFERENCES RIN_ROI_PROJECT(ID),
    CONSTRAINT CHK_PROJECT_BENEFITS_IS_DELETED CHECK (IS_DELETED IN (0, 1))
);

CREATE TABLE RIN_ROI_REPORT (
    REPORT_ID INT PRIMARY KEY,
    PROJECT_ID INT NOT NULL,
    REPORT_TYPE_ID INT NOT NULL,
    NAME NVARCHAR2(200),
    CONTENT CLOB,
    AS_OF_DATE DATE,
    CREATED_DATE DATE DEFAULT SYSDATE NOT NULL,
    CREATED_BY NVARCHAR2(200),
    IS_DELETED NUMBER(1) DEFAULT 0 NOT NULL,
    DELETED_AT TIMESTAMP,
    CONSTRAINT FK_REPORT_PROJECT FOREIGN KEY (PROJECT_ID) REFERENCES RIN_ROI_PROJECT(ID),
    CONSTRAINT FK_REPORT_TYPE FOREIGN KEY (REPORT_TYPE_ID) REFERENCES RIN_ROI_REPORT_TYPE(REPORT_TYPE_ID),
    CONSTRAINT CHK_REPORT_IS_DELETED CHECK (IS_DELETED IN (0, 1))
)
PARTITION BY RANGE (CREATED_DATE) (
    PARTITION P_2023 VALUES LESS THAN (TO_DATE('01-01-2024', 'DD-MM-YYYY')),
    PARTITION P_2024 VALUES LESS THAN (TO_DATE('01-01-2025', 'DD-MM-YYYY')),
    PARTITION P_FUTURE VALUES LESS THAN (MAXVALUE)
);

CREATE TABLE RIN_ROI_REPORT_TYPE (
    REPORT_TYPE_ID INT PRIMARY KEY,
    REPORT_NAME NVARCHAR2(200) NOT NULL,
    PROJECT_ID INT NOT NULL,
    REPORT_FREQUENCY NVARCHAR2(50) NOT NULL,
    CREATED_DATE DATE DEFAULT SYSDATE,
    UPDATED_DATE DATE,
    IS_DELETED NUMBER(1) DEFAULT 0 NOT NULL,
    DELETED_AT TIMESTAMP,
    CONSTRAINT FK_REPORT_TYPE_PROJECT FOREIGN KEY (PROJECT_ID) REFERENCES RIN_ROI_PROJECT(ID),
    CONSTRAINT CHK_REPORT_TYPE_IS_DELETED CHECK (IS_DELETED IN (0, 1))
);

CREATE TABLE RIN_ROI_REPORT_TYPE_METRIC (
    REPORT_TYPE_ID INT,
    METRIC_ID INT,
    IS_DELETED NUMBER(1) DEFAULT 0 NOT NULL,
    DELETED_AT TIMESTAMP,
    CONSTRAINT PK_REPORT_TYPE_METRIC PRIMARY KEY (REPORT_TYPE_ID, METRIC_ID),
    CONSTRAINT FK_REPORT_TYPE_METRIC_REPORT_TYPE FOREIGN KEY (REPORT_TYPE_ID) REFERENCES RIN_ROI_REPORT_TYPE(REPORT_TYPE_ID),
    CONSTRAINT FK_REPORT_TYPE_METRIC_METRIC FOREIGN KEY (METRIC_ID) REFERENCES RIN_ROI_METRIC(METRIC_ID),
    CONSTRAINT CHK_REPORT_TYPE_METRIC_IS_DELETED CHECK (IS_DELETED IN (0, 1))
);
CREATE TABLE RIN_ROI_EXPRESSION (
    EXPRESSION_ID INT PRIMARY KEY,
    REPORT_TYPE_ID INT NOT NULL,
    NAME NVARCHAR2(200) NOT NULL,
    FORMULA CLOB,
    CREATED_DATE DATE DEFAULT SYSDATE,
    IS_DELETED NUMBER(1) DEFAULT 0 NOT NULL,
    DELETED_AT TIMESTAMP,
    CONSTRAINT FK_EXPRESSION_REPORT_TYPE FOREIGN KEY (REPORT_TYPE_ID) REFERENCES RIN_ROI_REPORT_TYPE(REPORT_TYPE_ID),
    CONSTRAINT CHK_EXPRESSION_IS_DELETED CHECK (IS_DELETED IN (0, 1))
);

CREATE TABLE RIN_ROI_REPORT_TYPE_METRIC (
    REPORT_TYPE_ID INT,
    METRIC_ID INT,
    IS_DELETED NUMBER(1) DEFAULT 0 NOT NULL,
    DELETED_AT TIMESTAMP,
    CONSTRAINT PK_REPORT_TYPE_METRIC PRIMARY KEY (REPORT_TYPE_ID, METRIC_ID),
    CONSTRAINT FK_REPORT_TYPE_METRIC_REPORT_TYPE FOREIGN KEY (REPORT_TYPE_ID) REFERENCES RIN_ROI_REPORT_TYPE(REPORT_TYPE_ID),
    CONSTRAINT FK_REPORT_TYPE_METRIC_METRIC FOREIGN KEY (METRIC_ID) REFERENCES RIN_ROI_METRIC(METRIC_ID),
    CONSTRAINT CHK_REPORT_TYPE_METRIC_IS_DELETED CHECK (IS_DELETED IN (0, 1))
);
